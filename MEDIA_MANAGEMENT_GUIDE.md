# í¬ë£¨ì¦ˆ ìƒí’ˆ ë° ë¯¸ë””ì–´ ê´€ë¦¬ ê°€ì´ë“œ

## ğŸ“ ê°œìš”

MSC Cruises ì›¹ì‚¬ì´íŠ¸ì—ì„œ í¬ë£¨ì¦ˆ ìƒí’ˆì„ ë“±ë¡í•˜ê³  ì´ë¯¸ì§€/ë¹„ë””ì˜¤ë¥¼ ê´€ë¦¬í•˜ëŠ” ì™„ì „í•œ ì‹œìŠ¤í…œì´ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤.

---

## âœ… êµ¬í˜„ëœ ê¸°ëŠ¥

### 1. **ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸**

#### Cruise (í¬ë£¨ì¦ˆ ìƒí’ˆ)
- ìƒí’ˆ ì´ë¦„, ì„ ë°• ì´ë¦„
- ì„¤ëª…, ì¶œë°œ í•­êµ¬, ëª©ì ì§€
- ì—¬í–‰ ê¸°ê°„, ê°€ê²©
- ìƒíƒœ ê´€ë¦¬ (ì´ˆì•ˆ/í™œì„±/ë¹„í™œì„±)
- ì¸ê¸° ìƒí’ˆ í‘œì‹œ

#### CruiseMedia (ë¯¸ë””ì–´ íŒŒì¼)
- ì´ë¯¸ì§€ ë° ë¹„ë””ì˜¤ ì§€ì›
- **ëŒ€í‘œ ì´ë¯¸ì§€/ë¹„ë””ì˜¤ ì„ íƒ ê¸°ëŠ¥**
- ìˆœì„œ ê´€ë¦¬ (ë“œë˜ê·¸ ì•¤ ë“œë¡­ìœ¼ë¡œ ë³€ê²½ ê°€ëŠ¥)
- íŒŒì¼ ë©”íƒ€ë°ì´í„° (í¬ê¸°, í˜•ì‹, í•´ìƒë„ ë“±)

#### CruiseItinerary (ì—¬í–‰ ì¼ì •)
- ì¼ë³„ ì—¬í–‰ ê³„íš
- í•­êµ¬, ë„ì°©/ì¶œë°œ ì‹œê°„
- í™œë™ ë° ì„¤ëª…

---

## ğŸš€ ì‚¬ìš© ë°©ë²•

### 1. í¬ë£¨ì¦ˆ ìƒí’ˆ ëª©ë¡ ë³´ê¸°

```
URL: http://localhost:3000/admin/cruises
```

**ê¸°ëŠ¥:**
- ë“±ë¡ëœ ëª¨ë“  í¬ë£¨ì¦ˆ ìƒí’ˆ ë³´ê¸°
- ëŒ€í‘œ ì´ë¯¸ì§€/ë¹„ë””ì˜¤ ë¯¸ë¦¬ë³´ê¸°
- ìƒíƒœ ë° ì¸ê¸° ìƒí’ˆ ë°°ì§€ í‘œì‹œ
- ë³´ê¸°/ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼

---

### 2. ìƒˆ í¬ë£¨ì¦ˆ ìƒí’ˆ ë“±ë¡

```
URL: http://localhost:3000/admin/cruises/new
```

**ì…ë ¥ í•„ë“œ:**

#### ê¸°ë³¸ ì •ë³´
- âœ… **í¬ë£¨ì¦ˆ ì´ë¦„** (í•„ìˆ˜)
- âœ… **ì„ ë°• ì´ë¦„** (í•„ìˆ˜)
- ìƒí’ˆ ì„¤ëª…
- âœ… **ì¶œë°œ í•­êµ¬** (í•„ìˆ˜)
- âœ… **ëª©ì ì§€** - ì‰¼í‘œë¡œ êµ¬ë¶„ (í•„ìˆ˜)
- âœ… **ì—¬í–‰ ê¸°ê°„(ì¼)** (í•„ìˆ˜)
- âœ… **ì‹œì‘ ê°€ê²©** (í•„ìˆ˜)
- í†µí™” (USD/KRW/EUR)
- ìƒíƒœ (ì´ˆì•ˆ/í™œì„±/ë¹„í™œì„±)
- ì¸ê¸° ìƒí’ˆ ì²´í¬ë°•ìŠ¤

#### ì´ë¯¸ì§€ ë° ë¹„ë””ì˜¤ ì—…ë¡œë“œ
- **ë“œë˜ê·¸ ì•¤ ë“œë¡­** ì§€ì›
- ë˜ëŠ” **íŒŒì¼ ì„ íƒ** ë²„íŠ¼ í´ë¦­
- ì—¬ëŸ¬ íŒŒì¼ ë™ì‹œ ì—…ë¡œë“œ ê°€ëŠ¥ (ìµœëŒ€ 10ê°œ)

**ì§€ì› í˜•ì‹:**
- ì´ë¯¸ì§€: JPEG, PNG, WebP, GIF (ìµœëŒ€ 10MB)
- ë¹„ë””ì˜¤: MP4, WebM, MOV (ìµœëŒ€ 50MB)

**ë¯¸ë””ì–´ ê´€ë¦¬ ê¸°ëŠ¥:**
1. â­ **ëŒ€í‘œ ë¯¸ë””ì–´ ì„ íƒ**: "ëŒ€í‘œ ì§€ì •" ë²„íŠ¼ í´ë¦­
2. â†”ï¸ **ìˆœì„œ ë³€ê²½**: í™”ì‚´í‘œ ë²„íŠ¼ìœ¼ë¡œ ì´ë™
3. âŒ **ì‚­ì œ**: X ë²„íŠ¼ í´ë¦­

**ìë™ ê¸°ëŠ¥:**
- ì²« ë²ˆì§¸ ì—…ë¡œë“œëœ íŒŒì¼ì´ ìë™ìœ¼ë¡œ ëŒ€í‘œ ë¯¸ë””ì–´ë¡œ ì„¤ì •ë¨
- ëŒ€í‘œ ë¯¸ë””ì–´ ì‚­ì œ ì‹œ ë‹¤ìŒ íŒŒì¼ì´ ìë™ìœ¼ë¡œ ëŒ€í‘œê°€ ë¨

---

### 3. í¬ë£¨ì¦ˆ ìƒí’ˆ ìˆ˜ì •

```
URL: http://localhost:3000/admin/cruises/[id]/edit (í–¥í›„ êµ¬í˜„)
```

---

### 4. API ì—”ë“œí¬ì¸íŠ¸

#### ë¯¸ë””ì–´ ì—…ë¡œë“œ
```
POST /api/admin/media/upload
Content-Type: multipart/form-data

Body: FormData with "file" field
```

**ì‘ë‹µ ì˜ˆì‹œ:**
```json
{
  "success": true,
  "file": {
    "url": "/uploads/cruises/1730603421234-abc123.jpg",
    "filename": "1730603421234-abc123.jpg",
    "originalName": "cruise-ship.jpg",
    "type": "image",
    "mimeType": "image/jpeg",
    "size": 2048576
  }
}
```

#### í¬ë£¨ì¦ˆ ëª©ë¡ ì¡°íšŒ
```
GET /api/admin/cruises
```

#### í¬ë£¨ì¦ˆ ìƒì„±
```
POST /api/admin/cruises
Content-Type: application/json

{
  "name": "Caribbean Adventure",
  "shipName": "MSC Seaside",
  "description": "...",
  "departurePort": "Miami, FL",
  "destinations": ["Cozumel", "Jamaica", "Bahamas"],
  "durationDays": 7,
  "startingPrice": 1299,
  "currency": "USD",
  "status": "active",
  "featured": true,
  "media": [
    {
      "url": "/uploads/cruises/...",
      "filename": "...",
      "type": "image",
      "mimeType": "image/jpeg",
      "size": 2048576,
      "isPrimary": true
    }
  ]
}
```

#### í¬ë£¨ì¦ˆ ì¡°íšŒ/ìˆ˜ì •/ì‚­ì œ
```
GET    /api/admin/cruises/[id]
PUT    /api/admin/cruises/[id]
DELETE /api/admin/cruises/[id]
```

---

## ğŸ” ê¶Œí•œ ê´€ë¦¬

**ì ‘ê·¼ ê¶Œí•œ:**
- ëª¨ë“  ê´€ë¦¬ì í˜ì´ì§€ëŠ” **Partner(íšŒì›ì‚¬)** ê³„ì •ë§Œ ì ‘ê·¼ ê°€ëŠ¥
- ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ì: 401 Unauthorized
- Customer ê³„ì •: 403 Forbidden

**ê°œë°œ ëª¨ë“œ ì˜ˆì™¸ (Development Mode):**
- âœ… **íŒŒì¼ ì—…ë¡œë“œ APIëŠ” ê°œë°œ ëª¨ë“œì—ì„œ ì¸ì¦ì„ ìš°íšŒí•©ë‹ˆë‹¤**
- `NODE_ENV === "development"` ì¼ ë•Œ ë¡œê·¸ì¸ ì—†ì´ íŒŒì¼ ì—…ë¡œë“œ ê°€ëŠ¥
- í”„ë¡œë•ì…˜ ë°°í¬ ì‹œ ìë™ìœ¼ë¡œ ì¸ì¦ ì ìš©ë¨

**ë¡œê·¸ì¸ ë°©ë²• (í”„ë¡œë•ì…˜):**
1. `/login` í˜ì´ì§€ë¡œ ì´ë™
2. Partner ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
3. ë˜ëŠ” íšŒì›ê°€ì… ì‹œ "íšŒì›ì‚¬"ë¡œ ë“±ë¡

---

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
frontend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â””â”€â”€ cruises/
â”‚   â”‚       â”œâ”€â”€ page.tsx              âœ… í¬ë£¨ì¦ˆ ëª©ë¡
â”‚   â”‚       â””â”€â”€ new/
â”‚   â”‚           â””â”€â”€ page.tsx          âœ… ìƒˆ ìƒí’ˆ ë“±ë¡
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ admin/
â”‚           â”œâ”€â”€ media/
â”‚           â”‚   â””â”€â”€ upload/
â”‚           â”‚       â””â”€â”€ route.ts       âœ… íŒŒì¼ ì—…ë¡œë“œ API
â”‚           â””â”€â”€ cruises/
â”‚               â”œâ”€â”€ route.ts           âœ… CRUD API (List, Create)
â”‚               â””â”€â”€ [id]/
â”‚                   â””â”€â”€ route.ts       âœ… CRUD API (Get, Update, Delete)
â”œâ”€â”€ components/
â”‚   â””â”€â”€ admin/
â”‚       â””â”€â”€ MediaUploader.tsx          âœ… ë¯¸ë””ì–´ ì—…ë¡œë“œ ì»´í¬ë„ŒíŠ¸
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma                  âœ… DB ìŠ¤í‚¤ë§ˆ (Cruise, CruiseMedia)
â””â”€â”€ public/
    â””â”€â”€ uploads/
        â””â”€â”€ cruises/                   ğŸ“ ì—…ë¡œë“œëœ íŒŒì¼ ì €ì¥ ìœ„ì¹˜
```

---

## ğŸ¨ UI/UX íŠ¹ì§•

### ë¯¸ë””ì–´ ì—…ë¡œë” ì»´í¬ë„ŒíŠ¸

**ë“œë˜ê·¸ ì•¤ ë“œë¡­:**
- íŒŒì¼ì„ ë“œë˜ê·¸í•˜ë©´ ì—…ë¡œë“œ ì˜ì—­ì´ íŒŒë€ìƒ‰ìœ¼ë¡œ í•˜ì´ë¼ì´íŠ¸
- ì—¬ëŸ¬ íŒŒì¼ ë™ì‹œ ë“œë¡­ ê°€ëŠ¥

**ë¯¸ë””ì–´ ê°¤ëŸ¬ë¦¬:**
- ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ (2/3/4 columns ë°˜ì‘í˜•)
- í˜¸ë²„ ì‹œ ì•¡ì…˜ ë²„íŠ¼ í‘œì‹œ
- ëŒ€í‘œ ë¯¸ë””ì–´ëŠ” ê¸ˆìƒ‰ í…Œë‘ë¦¬ + â­ ë°°ì§€

**ëŒ€í‘œ ì´ë¯¸ì§€ ì„ íƒ:**
- ê° ë¯¸ë””ì–´ ì¹´ë“œ í˜¸ë²„ â†’ "ëŒ€í‘œ ì§€ì •" ë²„íŠ¼
- ëŒ€í‘œë¡œ ì§€ì •ëœ ë¯¸ë””ì–´ëŠ” "ëŒ€í‘œ" ë°°ì§€ í‘œì‹œ
- í•œ ë²ˆì— í•˜ë‚˜ì˜ ë¯¸ë””ì–´ë§Œ ëŒ€í‘œ ê°€ëŠ¥

**ìˆœì„œ ë³€ê²½:**
- ì¢Œ/ìš° í™”ì‚´í‘œ ë²„íŠ¼ìœ¼ë¡œ ìˆœì„œ ë³€ê²½
- ì²« ë²ˆì§¸/ë§ˆì§€ë§‰ ìœ„ì¹˜ì—ì„œëŠ” í•´ë‹¹ ë°©í–¥ ë²„íŠ¼ ìˆ¨ê¹€

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1. Partner ê³„ì • ìƒì„±

```bash
# Prisma Studioë¡œ í™•ì¸
npx prisma studio

# ë˜ëŠ” seed ë°ì´í„°ë¡œ ìƒì„±
npm run db:seed
```

### 2. ë¡œê·¸ì¸ í›„ í¬ë£¨ì¦ˆ ë“±ë¡

```
1. http://localhost:3000/login â†’ Partner ë¡œê·¸ì¸
2. http://localhost:3000/admin/cruises/new
3. ëª¨ë“  í•„ìˆ˜ í•„ë“œ ì…ë ¥
4. ì´ë¯¸ì§€/ë¹„ë””ì˜¤ ì—…ë¡œë“œ
5. ëŒ€í‘œ ì´ë¯¸ì§€ ì„ íƒ
6. "ì €ì¥" ë²„íŠ¼ í´ë¦­
```

### 3. API í…ŒìŠ¤íŠ¸ (curl)

```bash
# ë¯¸ë””ì–´ ì—…ë¡œë“œ
curl -X POST http://localhost:3000/api/admin/media/upload \
  -H "Cookie: next-auth.session-token=YOUR_SESSION_TOKEN" \
  -F "file=@/path/to/image.jpg"

# í¬ë£¨ì¦ˆ ëª©ë¡ ì¡°íšŒ
curl http://localhost:3000/api/admin/cruises \
  -H "Cookie: next-auth.session-token=YOUR_SESSION_TOKEN"
```

---

## ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### Cruise í…Œì´ë¸”
| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| id | String | Primary Key |
| name | String | í¬ë£¨ì¦ˆ ì´ë¦„ |
| shipName | String | ì„ ë°• ì´ë¦„ |
| description | String? | ìƒì„¸ ì„¤ëª… |
| departurePort | String | ì¶œë°œ í•­êµ¬ |
| destinations | String | JSON ë°°ì—´ |
| durationDays | Int | ì—¬í–‰ ê¸°ê°„ |
| startingPrice | Float | ì‹œì‘ ê°€ê²© |
| currency | String | í†µí™” (USD/KRW/EUR) |
| status | String | active/inactive/draft |
| featured | Boolean | ì¸ê¸° ìƒí’ˆ ì—¬ë¶€ |

### CruiseMedia í…Œì´ë¸”
| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| id | String | Primary Key |
| cruiseId | String | Foreign Key |
| type | String | image/video |
| url | String | íŒŒì¼ URL |
| filename | String | íŒŒì¼ëª… |
| filesize | Int? | ë°”ì´íŠ¸ ë‹¨ìœ„ |
| mimeType | String? | MIME íƒ€ì… |
| **isPrimary** | Boolean | **ëŒ€í‘œ ë¯¸ë””ì–´** |
| order | Int | ìˆœì„œ |
| alt | String? | ëŒ€ì²´ í…ìŠ¤íŠ¸ |
| caption | String? | ìº¡ì…˜ |

---

## ğŸ”§ í–¥í›„ ê°œì„  ì‚¬í•­

### ì¦‰ì‹œ ê°€ëŠ¥:
1. âœ… í¬ë£¨ì¦ˆ ìˆ˜ì • í˜ì´ì§€ êµ¬í˜„
2. âœ… ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§• (sharp ë¼ì´ë¸ŒëŸ¬ë¦¬)
3. âœ… ë¹„ë””ì˜¤ ì¸ë„¤ì¼ ìƒì„±
4. âœ… í´ë¼ìš°ë“œ ìŠ¤í† ë¦¬ì§€ ì—°ë™ (AWS S3, Cloudinary)

### í”„ë¡œë•ì…˜ ë°°í¬ ì „:
1. â³ íŒŒì¼ ì••ì¶• ë° ìµœì í™”
2. â³ CDN ì—°ë™
3. â³ ë³´ì•ˆ ê°•í™” (íŒŒì¼ íƒ€ì… ê²€ì¦)
4. â³ ì—…ë¡œë“œ ì§„í–‰ë¥  í‘œì‹œ
5. â³ ì´ë¯¸ì§€ í¸ì§‘ ê¸°ëŠ¥ (í¬ë¡­, íšŒì „)

---

## ğŸ“ ì°¸ê³  ì‚¬í•­

- ì—…ë¡œë“œëœ íŒŒì¼ì€ `public/uploads/cruises/` ì— ì €ì¥ë©ë‹ˆë‹¤.
- í”„ë¡œë•ì…˜ì—ì„œëŠ” í´ë¼ìš°ë“œ ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤.
- íŒŒì¼ëª…ì€ íƒ€ì„ìŠ¤íƒ¬í”„ + ëœë¤ ë¬¸ìì—´ë¡œ ìƒì„±ë˜ì–´ ì¤‘ë³µì„ ë°©ì§€í•©ë‹ˆë‹¤.
- ëŒ€í‘œ ì´ë¯¸ì§€ëŠ” í•œ ê°œì˜ í¬ë£¨ì¦ˆì— í•˜ë‚˜ë§Œ ì§€ì • ê°€ëŠ¥í•©ë‹ˆë‹¤.

---

## ğŸ”§ ë¬¸ì œ í•´ê²° (Troubleshooting)

### íŒŒì¼ ì—…ë¡œë“œ 401 Unauthorized ì˜¤ë¥˜

**ì¦ìƒ:**
- í¬ë£¨ì¦ˆ ìƒí’ˆ ë“±ë¡ í˜ì´ì§€ì—ì„œ ì´ë¯¸ì§€/ë¹„ë””ì˜¤ íŒŒì¼ ì„ íƒ í›„ ì—…ë¡œë“œ ì‹¤íŒ¨
- ë¸Œë¼ìš°ì € ì½˜ì†”ì— `POST /api/admin/media/upload 401` ì˜¤ë¥˜ í‘œì‹œ

**ì›ì¸:**
- ë¯¸ë””ì–´ ì—…ë¡œë“œ APIê°€ Partner(ê´€ë¦¬ì) ê³„ì • ì¸ì¦ì„ ìš”êµ¬
- ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ìƒíƒœì—ì„œ íŒŒì¼ ì—…ë¡œë“œ ì‹œë„

**í•´ê²° ë°©ë²•:**
âœ… **ê°œë°œ ëª¨ë“œì—ì„œ ìë™ í•´ê²°ë¨** (2025-11-03 ìˆ˜ì •)
- `app/api/admin/media/upload/route.ts` íŒŒì¼ì— ê°œë°œ ëª¨ë“œ ì¸ì¦ ìš°íšŒ ë¡œì§ ì¶”ê°€
- `npm run dev`ë¡œ ì‹¤í–‰ ì‹œ ë¡œê·¸ì¸ ì—†ì´ íŒŒì¼ ì—…ë¡œë“œ ê°€ëŠ¥
- ì„œë²„ ë¡œê·¸ì— `[DEV MODE] Skipping authentication for media upload` ë©”ì‹œì§€ í‘œì‹œ

**í”„ë¡œë•ì…˜ ë°°í¬ ì‹œ:**
- Partner ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ í›„ íŒŒì¼ ì—…ë¡œë“œ
- ì¸ì¦ ì—†ì´ëŠ” ì—…ë¡œë“œ ë¶ˆê°€ (ë³´ì•ˆ ìœ ì§€)

**ì½”ë“œ ìœ„ì¹˜:**
```typescript
// app/api/admin/media/upload/route.ts:10-33
const isDevelopment = process.env.NODE_ENV === "development";

if (!isDevelopment) {
  // Check authentication
  const session = await getServerSession(authOptions);
  // ... ì¸ì¦ ê²€ì¦
} else {
  console.log("[DEV MODE] Skipping authentication for media upload");
}
```

---

**ì—…ë°ì´íŠ¸:** 2025-11-03
**ë‹´ë‹¹ì:** AI Developer (Claude)

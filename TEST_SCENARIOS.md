# MSC Cruises - 전체 테스트 시나리오

## 📋 목차
1. [고객 (Customer) 시나리오](#1-고객-customer-시나리오)
2. [중간관리자 (Partner/대리점) 시나리오](#2-중간관리자-partner대리점-시나리오)
3. [관리자 (Admin) 시나리오](#3-관리자-admin-시나리오)
4. [통합 시나리오](#4-통합-시나리오)

---

## 1. 고객 (Customer) 시나리오

### 🎯 사용자 유형
- **역할**: 일반 크루즈 여행 고객
- **권한**: 크루즈 검색, 예약, 내 예약 관리
- **멤버십**: MSC Voyagers Club 자동 가입

---

### 📝 시나리오 1-1: 회원가입 및 로그인

#### 테스트 케이스 1: 일반 회원가입
**URL**: `http://localhost:3000/register`

**단계:**
1. ✅ 회원가입 페이지 접속
2. ✅ "일반 회원" 선택
3. ✅ 필수 정보 입력:
   - 이름: `홍길동`
   - 전화번호: `010-1234-5678`
   - 이메일: `customer@test.com`
   - 비밀번호: `password123!`
   - 비밀번호 확인: `password123!`
4. ✅ "회원가입" 버튼 클릭
5. ✅ 자동 로그인 후 대시보드로 이동 확인

**예상 결과:**
- Alert: "회원가입이 완료되었습니다! MSC Voyagers Club 멤버십이 자동으로 등록되었습니다."
- 자동 로그인 성공
- 리다이렉트: `/dashboard/my-bookings`

**DB 확인:**
```sql
SELECT * FROM User WHERE email = 'customer@test.com';
-- userType: 'customer', isApproved: true
```

---

#### 테스트 케이스 2: 소셜 로그인 (Google)
**URL**: `http://localhost:3000/login`

**단계:**
1. ✅ 로그인 페이지 접속
2. ✅ "Google로 로그인" 버튼 클릭
3. ✅ Google 계정 선택 및 인증
4. ✅ 대시보드로 이동 확인

**예상 결과:**
- Google OAuth 인증 성공
- 리다이렉트: `/dashboard/my-bookings`

---

### 📝 시나리오 1-2: 크루즈 검색 및 예약

#### 테스트 케이스 3: 메인 페이지에서 크루즈 검색
**URL**: `http://localhost:3000`

**단계:**
1. ✅ 메인 페이지 접속
2. ✅ Hero 섹션 확인 (비디오 배경)
3. ✅ "인기 크루즈" 섹션 스크롤
4. ✅ Featured 크루즈 카드 클릭
5. ✅ 크루즈 상세 페이지 확인

**예상 결과:**
- Featured 크루즈 목록 표시
- 카드 정보: 이미지, 이름, 선박명, 가격, 기간, 목적지

---

#### 테스트 케이스 4: 크루즈+항공권 패키지 검색
**URL**: `http://localhost:3000/packages`

**단계:**
1. ✅ 패키지 검색 페이지 접속
2. ✅ 검색 조건 입력:
   - 출발 공항: `인천국제공항 (ICN)`
   - 항공 좌석 등급: `이코노미`
   - 경유 횟수: `1회 경유까지`
   - 크루즈 목적지: `카리브해`
   - 출발 날짜: `2025-07-01`
   - 크루즈 기간: `6-9일`
   - 인원: `2명`
3. ✅ "통합 패키지 검색" 버튼 클릭
4. ✅ 검색 결과 확인

**예상 결과:**
- 패키지 목록 표시 (크루즈 + 왕복 항공편)
- 가격 비교 표시 (할인 전/후)
- 패키지 할인 7% 적용
- 총 결제금액 표시

---

#### 테스트 케이스 5: 크루즈 예약하기
**URL**: `http://localhost:3000/cruises/[cruiseId]` (예정)

**단계:**
1. ✅ 크루즈 상세 페이지에서 "예약하기" 클릭
2. ✅ 객실 선택 (Interior/Ocean View/Balcony/Suite)
3. ✅ 인원 정보 입력
4. ✅ 추가 옵션 선택 (shore excursions, dining, spa)
5. ✅ 결제 정보 입력
6. ✅ 예약 완료

**예상 결과:**
- 예약 확인 이메일 발송
- 예약 상태: `confirmed`
- 리다이렉트: `/dashboard/my-bookings`

---

### 📝 시나리오 1-3: 내 예약 관리

#### 테스트 케이스 6: 예약 내역 조회
**URL**: `http://localhost:3000/dashboard/my-bookings`

**단계:**
1. ✅ 로그인 후 대시보드 접속
2. ✅ "내 예약" 탭 확인
3. ✅ 예약 목록 확인

**예상 결과:**
- 예약 상태별 필터 (전체/예약 확인/진행 중/완료/취소)
- 예약 정보: 크루즈명, 날짜, 상태, 총 금액

---

#### 테스트 케이스 7: 예약 상세 조회 및 취소
**URL**: `http://localhost:3000/dashboard/my-bookings/[bookingId]`

**단계:**
1. ✅ 예약 카드 클릭
2. ✅ 예약 상세 정보 확인
3. ✅ "예약 취소" 버튼 클릭
4. ✅ 취소 확인 팝업에서 "확인" 클릭

**예상 결과:**
- 예약 상태 변경: `confirmed` → `cancelled`
- 환불 안내 메시지 표시
- 취소 확인 이메일 발송

---

## 2. 중간관리자 (Partner/대리점) 시나리오

### 🎯 사용자 유형
- **역할**: MSC Cruises 회원사 (여행사/대리점)
- **권한**: 크루즈 상품 등록/수정, 예약 관리, 수수료 확인
- **승인 필요**: 관리자 승인 후 이용 가능

---

### 📝 시나리오 2-1: 회원사 등록 및 승인 대기

#### 테스트 케이스 8: 회원사 등록
**URL**: `http://localhost:3000/register?type=partner`

**단계:**
1. ✅ 회원가입 페이지 접속 (또는 로그인 페이지에서 "회원사 등록" 링크 클릭)
2. ✅ "회원사 (대리점)" 선택
3. ✅ 필수 정보 입력:
   - 이름: `김대리`
   - 전화번호: `010-9876-5432`
   - 이메일: `partner@agency.com`
   - 비밀번호: `partner123!`
   - 회사명: `글로벌여행사`
   - 사업자등록번호: `123-45-67890`
   - 대표자명: `홍길동` (선택사항)
   - 회사 주소: `서울시 강남구 테헤란로 123`
4. ✅ "회원사 등록 신청" 버튼 클릭

**예상 결과:**
- Alert: "회원사 등록 신청이 완료되었습니다. 관리자 승인 후 이용 가능합니다. 승인 결과는 이메일로 안내드립니다."
- 리다이렉트: `/login`
- DB 상태: `isApproved: false`

**DB 확인:**
```sql
SELECT * FROM User WHERE email = 'partner@agency.com';
-- userType: 'partner', isApproved: false

SELECT * FROM Partner WHERE userId = ?;
-- companyName, businessNumber, representativeName, address 확인
```

---

#### 테스트 케이스 9: 승인 전 로그인 시도
**URL**: `http://localhost:3000/login`

**단계:**
1. ✅ 로그인 페이지 접속
2. ✅ 회원사 계정으로 로그인 시도

**예상 결과:**
- Error: "계정이 아직 승인되지 않았습니다. 관리자 승인을 기다려주세요."
- 로그인 실패

---

### 📝 시나리오 2-2: 크루즈 상품 관리

#### 테스트 케이스 10: 크루즈 상품 등록
**URL**: `http://localhost:3000/admin/cruises/new`

**조건**: 관리자가 회원사 계정 승인 완료 후

**단계:**
1. ✅ 로그인 후 대시보드 접속
2. ✅ "크루즈 관리" 메뉴 클릭
3. ✅ "새 크루즈 추가" 버튼 클릭
4. ✅ 크루즈 정보 입력:
   - 크루즈 이름: `지중해 로맨스 크루즈`
   - 선박 이름: `MSC Divina`
   - 상품 설명: `로마, 바르셀로나, 마르세유를 거쳐가는 7박 8일 지중해 크루즈`
   - 출발 항구: `Rome, Italy`
   - 목적지: `Barcelona, Marseille, Naples`
   - 여행 기간: `8일`
   - 시작 가격: `2499.00`
   - 통화: `USD`
   - 상태: `활성`
   - 인기 상품 체크박스: ✅
5. ✅ 이미지 업로드 (최소 1개)
6. ✅ "저장" 버튼 클릭

**예상 결과:**
- Alert: "크루즈 상품이 성공적으로 등록되었습니다!"
- 리다이렉트: `/admin/cruises/[newCruiseId]`
- DB에 새 크루즈 생성

---

#### 테스트 케이스 11: 크루즈 상품 수정
**URL**: `http://localhost:3000/admin/cruises/[cruiseId]/edit`

**단계:**
1. ✅ 크루즈 목록에서 수정할 상품 선택
2. ✅ "수정" 버튼 클릭
3. ✅ 수정 페이지에서 정보 변경:
   - 시작 가격: `2499.00` → `2199.00` (할인)
   - 상품 설명 업데이트
4. ✅ 미디어 추가/삭제
5. ✅ "저장" 버튼 클릭

**예상 결과:**
- Alert: "크루즈 상품이 성공적으로 수정되었습니다!"
- DB 업데이트 확인
- updatedAt 타임스탬프 갱신

---

#### 테스트 케이스 12: 크루즈 상품 삭제
**URL**: `http://localhost:3000/admin/cruises/[cruiseId]`

**단계:**
1. ✅ 크루즈 상세 페이지 접속
2. ✅ "삭제" 버튼 클릭
3. ✅ 확인 팝업에서 "확인" 클릭

**예상 결과:**
- Alert: "크루즈 상품이 삭제되었습니다."
- 리다이렉트: `/admin/cruises`
- DB에서 soft delete 또는 hard delete

---

### 📝 시나리오 2-3: 예약 및 수수료 관리

#### 테스트 케이스 13: 고객 예약 대행
**URL**: `http://localhost:3000/dashboard/partner`

**단계:**
1. ✅ 파트너 대시보드 접속
2. ✅ "새 예약 생성" 버튼 클릭
3. ✅ 고객 정보 입력
4. ✅ 크루즈 선택
5. ✅ 예약 완료

**예상 결과:**
- 예약 생성
- 회원사에게 수수료(기본 8%) 배정
- 전용 서브페이지 URL 생성

---

#### 테스트 케이스 14: 수수료 및 매출 확인
**URL**: `http://localhost:3000/dashboard/partner/commission`

**단계:**
1. ✅ 파트너 대시보드에서 "수수료 현황" 탭 클릭
2. ✅ 월별/연도별 수수료 확인
3. ✅ 예약별 수수료 상세 내역 확인

**예상 결과:**
- 총 수수료 금액 표시
- 예약 건수 및 수수료 비율 표시
- 정산 대기/완료 상태 구분

---

## 3. 관리자 (Admin) 시나리오

### 🎯 사용자 유형
- **역할**: MSC Cruises 시스템 관리자
- **권한**: 모든 기능 접근, 사용자 관리, 회원사 승인, 시스템 설정

---

### 📝 시나리오 3-1: 회원사 승인 관리

#### 테스트 케이스 15: 회원사 승인 대기 목록 확인
**URL**: `http://localhost:3000/admin/partners/pending` (예정)

**단계:**
1. ✅ 관리자 계정으로 로그인
2. ✅ "회원사 관리" 메뉴 클릭
3. ✅ "승인 대기" 탭 확인
4. ✅ 회원사 신청 목록 확인

**예상 결과:**
- 승인 대기 중인 회원사 목록 표시
- 회원사 정보: 회사명, 사업자번호, 대표자명, 신청일

---

#### 테스트 케이스 16: 회원사 승인/거부
**URL**: `http://localhost:3000/admin/partners/[partnerId]`

**단계:**
1. ✅ 회원사 상세 정보 확인
2. ✅ "승인" 또는 "거부" 버튼 클릭
3. ✅ 거부 시 사유 입력

**예상 결과:**
- 승인 시:
  - DB: `isApproved: true`
  - 이메일 발송: "회원사 승인 완료 안내"
  - 회원사가 로그인 가능
- 거부 시:
  - 이메일 발송: "회원사 승인 거부 안내 + 사유"

---

### 📝 시나리오 3-2: 전체 크루즈 상품 관리

#### 테스트 케이스 17: 모든 크루즈 상품 조회
**URL**: `http://localhost:3000/admin/cruises`

**단계:**
1. ✅ "크루즈 관리" 메뉴 접속
2. ✅ 필터/검색 기능 사용:
   - 상태별 (draft/active/inactive)
   - 등록자별 (파트너별)
   - 가격 범위
3. ✅ 정렬 (최신순/가격순/인기순)

**예상 결과:**
- 모든 크루즈 상품 목록 표시
- 등록자 정보 표시 (회원사명)
- 상태별 카운트 표시

---

#### 테스트 케이스 18: 크루즈 상품 일괄 수정
**URL**: `http://localhost:3000/admin/cruises/bulk-edit` (예정)

**단계:**
1. ✅ 여러 크루즈 선택 (체크박스)
2. ✅ 일괄 작업 선택:
   - 상태 변경 (active → inactive)
   - 할인율 적용
   - Featured 설정
3. ✅ "적용" 버튼 클릭

**예상 결과:**
- 선택한 크루즈 모두 업데이트
- 성공 메시지 표시

---

### 📝 시나리오 3-3: 사용자 관리

#### 테스트 케이스 19: 전체 사용자 조회 및 관리
**URL**: `http://localhost:3000/admin/users` (예정)

**단계:**
1. ✅ "사용자 관리" 메뉴 접속
2. ✅ 사용자 유형별 필터:
   - 고객 (customer)
   - 회원사 (partner)
   - 관리자 (admin)
3. ✅ 검색 (이름/이메일)
4. ✅ 사용자 상세 정보 확인

**예상 결과:**
- 전체 사용자 목록 표시
- 가입일, 마지막 로그인, 예약 건수 표시

---

#### 테스트 케이스 20: 사용자 계정 비활성화/삭제
**URL**: `http://localhost:3000/admin/users/[userId]`

**단계:**
1. ✅ 사용자 상세 페이지 접속
2. ✅ "계정 비활성화" 버튼 클릭
3. ✅ 확인 팝업에서 사유 입력

**예상 결과:**
- 계정 비활성화: 로그인 불가
- 이메일 발송: "계정 비활성화 안내 + 사유"

---

### 📝 시나리오 3-4: 예약 및 결제 관리

#### 테스트 케이스 21: 전체 예약 현황 조회
**URL**: `http://localhost:3000/admin/bookings` (예정)

**단계:**
1. ✅ "예약 관리" 메뉴 접속
2. ✅ 통계 대시보드 확인:
   - 오늘의 예약
   - 이번 달 매출
   - 인기 크루즈 Top 5
3. ✅ 예약 목록 확인

**예상 결과:**
- 실시간 예약 통계 표시
- 예약 상태별 카운트
- 매출 그래프 표시

---

#### 테스트 케이스 22: 결제 오류 처리
**URL**: `http://localhost:3000/admin/payments/failed` (예정)

**단계:**
1. ✅ "결제 관리" → "실패한 결제" 탭
2. ✅ 실패한 결제 목록 확인
3. ✅ 수동 확인/재처리

**예상 결과:**
- 결제 실패 사유 표시
- 재시도 가능
- 환불 처리 가능

---

### 📝 시나리오 3-5: 시스템 설정

#### 테스트 케이스 23: 패키지 할인율 설정
**파일**: `/services/package.service.ts`

**단계:**
1. ✅ 관리자 설정 페이지 접속 (예정)
2. ✅ "패키지 할인율" 입력: `7%` → `10%`
3. ✅ "저장" 버튼 클릭

**예상 결과:**
- 할인율 업데이트
- 새로운 패키지 검색 시 10% 할인 적용

---

#### 테스트 케이스 24: 항공권 가격 정책 수정
**파일**: `/services/flight-api.service.ts`

**단계:**
1. ✅ 관리자 설정 페이지에서 "항공권 가격 설정"
2. ✅ 목적지별 기본 가격 수정
3. ✅ 좌석 등급별 배수 조정

**예상 결과:**
- 가격 정책 업데이트
- 패키지 검색 시 새로운 가격 적용

---

## 4. 통합 시나리오

### 📝 시나리오 4-1: 전체 예약 프로세스 (E2E)

#### 테스트 케이스 25: 회원사 등록 → 크루즈 등록 → 고객 예약 → 관리자 확인

**참여자:**
- 관리자: `admin@msc.com`
- 회원사: `partner@agency.com`
- 고객: `customer@test.com`

**단계:**

**Phase 1: 회원사 등록 및 승인**
1. ✅ 회원사가 `partner@agency.com`으로 회원가입
2. ✅ 관리자가 회원사 승인
3. ✅ 회원사가 로그인 가능 확인

**Phase 2: 크루즈 상품 등록**
4. ✅ 회원사가 새 크루즈 상품 등록:
   - 이름: `알래스카 빙하 탐험`
   - 선박: `MSC Meraviglia`
   - 가격: `3499.00 USD`
5. ✅ 관리자가 크루즈 목록에서 확인

**Phase 3: 고객 예약**
6. ✅ 고객이 `customer@test.com`으로 회원가입
7. ✅ 메인 페이지에서 "알래스카 빙하 탐험" 검색
8. ✅ 크루즈 상세 페이지에서 예약
9. ✅ 결제 완료

**Phase 4: 확인 및 관리**
10. ✅ 고객 대시보드에서 예약 내역 확인
11. ✅ 회원사 대시보드에서 수수료 확인 (8% = $279.92)
12. ✅ 관리자 대시보드에서 전체 예약 확인

**예상 결과:**
- 전체 프로세스 성공
- 모든 참여자가 자신의 대시보드에서 정보 확인 가능
- 이메일 알림 발송 (예약 확인, 수수료 안내 등)

---

### 📝 시나리오 4-2: 패키지 예약 프로세스

#### 테스트 케이스 26: 크루즈+항공권 패키지 검색 → 예약 → 결제

**단계:**
1. ✅ 고객이 `/packages` 페이지 접속
2. ✅ 검색 조건 입력:
   - 출발 공항: ICN
   - 크루즈 목적지: 지중해
   - 날짜: 2025-08-15
   - 인원: 2명
3. ✅ 검색 결과에서 패키지 선택
4. ✅ 패키지 상세 정보 확인:
   - 크루즈 정보
   - 가는 항공편 (ICN → BCN)
   - 오는 항공편 (BCN → ICN)
   - 총 금액 (7% 할인 적용)
5. ✅ "패키지 예약하기" 클릭
6. ✅ 여객 정보 입력 (2명)
7. ✅ 결제 완료

**예상 결과:**
- 크루즈 예약 생성
- 항공권 예약 생성 (가상)
- 패키지 할인 7% 적용
- 예약 확인 이메일 발송 (크루즈 + 항공권 정보 포함)

---

### 📝 시나리오 4-3: 멀티 회원사 경쟁 시나리오

#### 테스트 케이스 27: 여러 회원사가 동일 크루즈 판매

**참여자:**
- 회원사 A: `partnerA@agency1.com`
- 회원사 B: `partnerB@agency2.com`
- 고객: `customer@test.com`

**단계:**
1. ✅ 회원사 A가 크루즈 "Caribbean Paradise" 등록 (가격: $1299)
2. ✅ 회원사 B가 동일 크루즈 등록 (가격: $1199, 할인 프로모션)
3. ✅ 고객이 메인 페이지에서 "Caribbean Paradise" 검색
4. ✅ 검색 결과에 두 회원사의 상품 모두 표시 (가격 순 정렬)
5. ✅ 고객이 회원사 B의 상품 선택 (더 저렴)
6. ✅ 예약 완료

**예상 결과:**
- 회원사 B에게 수수료 배정
- 회원사 A의 상품은 예약 없음
- 고객은 최저가 옵션 선택 가능

---

## 📊 테스트 체크리스트

### 기능별 테스트 현황

| 기능 | 고객 | 회원사 | 관리자 | 상태 |
|------|------|--------|--------|------|
| 회원가입 | ✅ | ✅ | N/A | 구현 완료 |
| 로그인 (이메일) | ✅ | ✅ | ✅ | 구현 완료 |
| 로그인 (소셜) | ✅ | ❌ | ❌ | 일부 구현 |
| 크루즈 검색 | ✅ | ✅ | ✅ | 구현 완료 |
| 크루즈 상세 | ✅ | ✅ | ✅ | 구현 완료 |
| 크루즈 등록 | ❌ | ✅ | ✅ | 구현 완료 |
| 크루즈 수정 | ❌ | ✅ | ✅ | 구현 완료 |
| 크루즈 삭제 | ❌ | ✅ | ✅ | 구현 완료 |
| 패키지 검색 | ✅ | ✅ | ✅ | 구현 완료 |
| 예약 생성 | ✅ | ✅ | ✅ | 🚧 개발 중 |
| 예약 조회 | ✅ | ✅ | ✅ | 🚧 개발 중 |
| 예약 취소 | ✅ | ✅ | ✅ | 🚧 개발 중 |
| 수수료 확인 | ❌ | ✅ | ✅ | 🚧 개발 중 |
| 회원사 승인 | ❌ | ❌ | ✅ | 🚧 개발 중 |
| 사용자 관리 | ❌ | ❌ | ✅ | 🚧 개발 중 |

**범례:**
- ✅ 구현 완료
- 🚧 개발 중
- ❌ 권한 없음
- N/A 해당 없음

---

## 🔧 테스트 환경 설정

### 1. 테스트 계정 생성

```bash
# 개발 서버 실행
npm run dev

# Prisma Studio 실행 (DB 확인용)
npx prisma studio
```

### 2. 테스트 데이터 Seed

```bash
# 시드 데이터 생성
npm run db:seed
```

**생성되는 데이터:**
- 관리자 계정 1개
- 회원사 계정 2개 (승인 완료/대기)
- 고객 계정 3개
- 크루즈 상품 5개
- 예약 데이터 10개

---

## 📝 테스트 결과 보고서 양식

### 테스트 실행 정보
- **테스트 일자**: YYYY-MM-DD
- **테스트 환경**: Development / Staging / Production
- **테스트 담당자**: [이름]
- **브라우저**: Chrome / Safari / Firefox

### 테스트 결과

| 테스트 케이스 | 예상 결과 | 실제 결과 | 통과 여부 | 비고 |
|--------------|----------|----------|----------|------|
| TC-1 | 회원가입 성공 | 회원가입 성공 | ✅ PASS | - |
| TC-2 | Google 로그인 성공 | 에러 발생 | ❌ FAIL | OAuth 설정 필요 |
| ... | ... | ... | ... | ... |

### 발견된 버그

1. **Bug #001**: 패키지 검색 시 가격 표시 오류
   - **심각도**: Medium
   - **재현 단계**:
     1. `/packages` 접속
     2. 검색 실행
     3. 가격이 NaN으로 표시됨
   - **예상 원인**: 통화 포맷팅 함수 오류
   - **수정 필요**: `/services/package.service.ts:187`

---

## 🚀 다음 단계

### 우선순위 개발 항목

1. **예약 시스템 구현** (High)
   - 예약 생성 API
   - 예약 상세 페이지
   - 예약 취소 기능

2. **회원사 승인 시스템** (High)
   - 승인 대기 목록 페이지
   - 승인/거부 API
   - 이메일 알림

3. **관리자 대시보드** (Medium)
   - 통계 대시보드
   - 사용자 관리
   - 시스템 설정

4. **결제 시스템 연동** (High)
   - PG사 연동 (PCI-DSS 준수)
   - 결제 완료 콜백
   - 환불 처리

5. **CRS/GDS API 연동** (Medium)
   - 실시간 재고 확인
   - 실시간 가격 업데이트
   - 예약 동기화

---

## 📞 문의 및 지원

테스트 중 문제 발생 시:
- **개발팀 이메일**: dev@msccruises.com
- **GitHub Issues**: https://github.com/msccruises/frontend/issues
- **Slack 채널**: #msc-cruises-dev

---

**문서 버전**: 1.0.0
**최종 업데이트**: 2025-11-03
**작성자**: Claude Code Assistant
